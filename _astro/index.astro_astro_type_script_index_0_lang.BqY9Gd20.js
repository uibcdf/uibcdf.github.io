const N=document.querySelector("[data-parallax-stage]"),j=N?.querySelector("[data-parallax-figure]"),t=document.querySelector(".home-hero"),Ut=document.querySelector(".home-what-stage"),C=document.querySelector(".home-what-pin"),ut=document.querySelector(".home-what-copy"),ht=document.querySelector(".home-what-cta");document.querySelector(".scroll-cue--message");const _t=document.querySelector(".hero-frieze"),jt=document.querySelector(".home-hub-stage"),pt=document.querySelector(".home-hub-pin"),mt=document.querySelector(".updates-stage"),f=document.querySelector(".updates-pin"),Gt=document.querySelector(".updates-panel h2"),dt=document.querySelector(".scroll-cue--updates"),Jt=document.querySelector(".contact-stage"),Kt=document.querySelector(".contact-panel"),Qt=window.matchMedia("(prefers-reduced-motion: reduce)").matches;document.documentElement.style.setProperty("--s0-gray-alpha","0.85");document.documentElement.style.setProperty("--s3-warm-alpha","0");if(N&&j&&!Qt){let R=!1,o=.18,s=o,n=0,y=0,S=0,c=o,p=0,b=0,B=0,x=null,i=null,u=!1,a=null,m=null,M=null,d=null,E=!1,H=null;const G=()=>{c+=(s-c)*.28,E?p=n:p+=(n-p)*.28,b+=(y-b)*.28,B+=(S-B)*.28,t?.style.setProperty("--hero-line-scale",c.toFixed(4)),t?.style.setProperty("--hero-line-shift",`${p.toFixed(2)}px`),t?.style.setProperty("--hero-line-snake",b.toFixed(4)),t?.style.setProperty("--hero-line-vertical",`${B.toFixed(2)}px`);const w=Math.abs(s-c)<8e-4,l=Math.abs(n-p)<.25,e=Math.abs(y-b)<.002,r=Math.abs(S-B)<.25;if(w&&l&&e&&r){t?.style.setProperty("--hero-line-scale",s.toFixed(4)),t?.style.setProperty("--hero-line-shift",`${n.toFixed(2)}px`),t?.style.setProperty("--hero-line-snake",y.toFixed(4)),t?.style.setProperty("--hero-line-vertical",`${S.toFixed(2)}px`),H=null;return}H=requestAnimationFrame(G)},J=()=>{H===null&&(H=requestAnimationFrame(G))},Y=()=>{t&&(o=.18,s=o,c=o,t.style.setProperty("--hero-line-scale",o.toFixed(4)),t.style.setProperty("--hero-line-shift","0px"),t.style.setProperty("--hero-line-snake","0"),t.style.setProperty("--hero-line-vertical","0px"))},gt=()=>{if(!t||!C||!ut||!ht)return 0;const w=(parseFloat(getComputedStyle(t).top)||0)+t.getBoundingClientRect().height,l=parseFloat(getComputedStyle(C).top)||0,e=C.getBoundingClientRect(),r=ut.getBoundingClientRect(),z=ht.getBoundingClientRect(),$=r.bottom-e.top,T=z.top-e.top,D=l+($+T)*.5;return Math.max(0,D-w)},A=()=>{const P=N.offsetTop,w=N.offsetHeight,l=window.innerHeight||1,e=window.scrollY||window.pageYOffset,r=Math.max(0,P-l*.05),z=Math.max(420,w-l*.6),$=(e-r)/z,T=Math.max(0,Math.min(1,$)),D=(.85*(1-T)).toFixed(3);document.documentElement.style.setProperty("--s0-gray-alpha",D);const ft=-120*T,yt=1-.9*T;if(j.style.transform=`translateY(${ft}px)`,j.style.opacity=Math.max(.08,yt).toFixed(3),e<3){x=null,i=null,u=!1,a=null,m=null,M=null,d=null,E=!1,s=o,n=0,y=0,S=0,t?.style.setProperty("--hero-line-progress","0"),J(),R=!1;return}const St=r+6,xt=Ut?.offsetTop??P,Mt=C&&parseFloat(getComputedStyle(C).top)||0,Pt=Math.max(70,Math.round((window.innerHeight||900)*.1)),F=Math.max(St+80,xt-Mt-Pt),Q=jt?.offsetTop??P,wt=pt&&parseFloat(getComputedStyle(pt).top)||0,O=Math.max(F+80,Q-wt),Tt=(e-r)/Math.max(1,F-r),W=Math.max(0,Math.min(1,Tt)),X=Math.max(480,Math.round((window.innerHeight||900)*.9)),L=F+X,Ft=e>L?(e-L)/Math.max(1,O-L):0,Lt=Math.max(0,Math.min(1,Ft)),Z=e<=F?.5*W:e<=L?.5:.5+.5*Lt;s=o+(1-o)*Z,t?.style.setProperty("--hero-line-progress",Z.toFixed(3));const tt=t?.getBoundingClientRect().bottom??0;x===null&&(x=gt());const v=x??0,kt=v*W,k=Math.max(0,(_t?.getBoundingClientRect().top??tt)-tt),qt=1.2,V=mt?.offsetTop??Q,et=f&&parseFloat(getComputedStyle(f).top)||0,Ct=Math.max(O+1,V-et),Rt=mt?.offsetHeight??0,bt=f?.offsetHeight??0,Bt=V+Rt-bt-et,Et=O+X,U=L,h=e>=Et;e<=U||h?u=!1:!u&&k<=v+qt&&(u=!0);const ot=u?k:v,_=i===null?ot:Math.min(i,ot),nt=_;if(!h)a=null,m=null,M=null,d=null;else if(a===null){a=e,m=nt;const Dt=f&&parseFloat(getComputedStyle(f).top)||0,ct=f?.getBoundingClientRect(),it=Gt?.getBoundingClientRect(),Ot=ct&&it?it.bottom-ct.top:0,Vt=(parseFloat(getComputedStyle(t).top)||0)+t.getBoundingClientRect().height;M=Math.max(m,Math.max(0,Dt+Ot+6-Vt))}const Ht=h&&a!==null?(e-a)/Math.max(1,Ct-a):0,vt=Math.max(0,Math.min(1,Ht)),I=m??nt,It=Math.max(I,M??I),st=I+(It-I)*vt,at=d===null?st:Math.max(d,st);h?(i=null,d=at):i=_,E=e>U&&!h,n=e<=F?kt:e<=U?v:h?at:_,u&&!h&&(n=k,p=k,i=k);const Nt=Jt?.offsetTop??V+l,q=Bt,lt=Number.isFinite(q)?Math.max(q+1,Nt-l*.18):Number.POSITIVE_INFINITY,rt=Number.isFinite(q)&&Number.isFinite(lt)?(e-q)/Math.max(1,lt-q):0,g=Number.isFinite(rt)?Math.max(0,Math.min(1,rt)):0;y=g;const Yt=44*g;n=Math.max(0,n-Yt),dt&&(dt.style.opacity=(1-g).toFixed(3));const At=(.39*g).toFixed(3);document.documentElement.style.setProperty("--s3-warm-alpha",At);const zt=Kt?.clientHeight??0,$t=Math.max(0,zt-16);S=Number.isFinite(g)?$t*g:0,J(),R=!1},K=()=>{R||(R=!0,requestAnimationFrame(A))};Y(),t?.classList.add("line-animated"),A(),requestAnimationFrame(()=>{Y(),A()}),window.addEventListener("scroll",K,{passive:!0}),window.addEventListener("resize",()=>{x=null,i=null,u=!1,a=null,m=null,M=null,d=null,E=!1,Y(),s=Math.max(s,o),c=Math.max(c,o),K()})}
